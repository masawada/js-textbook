# 関数
多くのプログラミング言語において同様の処理をまとめるため関数の機能が提供されています。JavaScriptでも関数を作成することができますが、その性質は他の言語と若干異なります。

## 関数文
関数を定義するには`function`というキーワードを用います。定義した関数を呼び出すには識別子に`()`をつけます。関数文の`{}`の最後にはセミコロンをつける必要はありません。関数の内部から関数の呼び出し元に値を返すには`return`文を用います。

```js
function 識別子 (仮引数) {
  // 処理
}

識別子(実引数);
```

##### 関数文の例:
```js
function sayHelloTo(name) {
  return 'Hello, ' + name;
}

sayHelloTo('John');
```

sayHelloToという関数を定義して呼び出しています。関数の内部から文字列`'Hello, '`と引数として得た文字列を結合した文字列を返しています。

## 関数式
JavaScriptでは関数を定義する方法がもう一つ提供されています。`var`を用いて変数を宣言するのと同じように関数を宣言する方法です。この場合は`{}`の後にセミコロンをつけるべきです。

```js
var 識別子 = function(仮引数) {
  // 処理
};

識別子(実引数);
```

JavaScriptにおいて関数は値です。そのため、このように変数に関数を代入することができます。これがJavaScriptの大きな特徴のひとつです。

##### 関数式の例:
```js
var sayHelloTo = function(name) {
  return 'Hello, ' + name;
};

sayHelloTo('John');
```

### 名前付き関数式
関数式で関数を定義する際、関数に関数内部から呼び出すことができる名前を付与することができます。

```js
var 識別子1 = function 識別子2(仮引数) {
  // 処理
  識別子2(実引数);
}

識別子1(実引数);
```

関数外部からは識別子1で、関数内部からは識別子1および識別子2で自身を呼びだすことができます。

##### 名前付き関数式の例:
```js
var fact = function self(n) {
  if (n == 0) return 1;
  return n * self(n - 1);
};

fact(5); // 120
```

引数に与えられた数の階乗を計算するプログラムです。関数内部から自身を呼び出して再帰処理を行っています。

## 関数文と関数式の違い
JavaScriptのプログラムが実行される際、まず関数文が存在するかを確認して関数定義が行われます。その後プログラムの上から順に処理が実行されます。したがって、以下のようなコードは問題なく動作します。

```js
sayHelloTo('John');

function sayHelloTo(name) {
  return 'Hello, ' + name;
}
```

しかし、以下のコードはエラーが発生します。

```js
sayHelloTo('John');

var sayHelloTo = function(name) {
  return 'Hello, ' + name;
};
```

これは関数が定義される前に関数呼び出しを行っているためです。

## 関数とスコープ
変数の影響範囲(どの範囲であれば同じ名前の変数が同じ変数であるか)のことをスコープといいます。JavaScriptでは関数スコープのみ存在し、それ以外では同一の変数を参照します。以下の例で確認しましょう。

```js
var a = 10;

var f = function() {
  var a = 5;
  // ここではaは5
};

// ここではaは10
f();
// ここではaは10
```

まず`a`に10を代入しています。その次に関数`f`を定義し呼び出しています。関数の呼び出し直前では当然`a`は10のままです。関数内で`a`に5が代入されており、その関数内では`a`は5として扱われます。関数スコープのため、関数内部での変更の影響は関数の外に及びません。よって、関数呼び出し後の`a`の値は10になります。

しかし、注意点があります。

```js
var a = 10;

var f = function() {
  a = 5;
  // ここではaは5
};

// ここではaは10
f();
// ここではaは5
```

このプログラムのように関数の中で`var`を用いて変数を宣言しない場合、関数の呼び出し元の変数を参照します。ここでは呼び出し元の`a`を参照しているため、関数`f`を呼び出すと関数内部での`a`の変更が関数を抜けた後にも影響を及ぼします。

引数として受けた変数は関数内で`var`を用いて新たに宣言しなくてもその関数内部のみで有効になります。

## 即時関数
前項で述べた通り関数の外と中で参照する変数を切り替えることができます。これを利用して、一時的な変数を多量に使う複雑な処理を記述する際にそれらを他の処理とは切り離して記述する方法が即時関数と呼ばれる記法です。

```js
(function(仮引数) {
  // 複雑な処理
})(実引数);
```

関数を`()`で括り、最後に`()`で呼び出します。呼び出し時に引数を渡して関数で受け取ることもできます。

## 値渡しと参照渡し
引数を与えて関数を呼び出すとき、気をつける必要があるのが参照渡しと値渡しです。JavaScriptではプリミティブ値を引数に与えると値渡しになります。オブジェクトを引数に与えると参照渡しになります。値渡しで引き渡された値を変更した場合、元の値は変更されません。参照渡しで渡された値を変更した場合、元の値が変更されます。

##### 値渡しの例:
```js
var message = 'Hello';
var process = function(message) {
  message = message + 'Good bye';
  return message; // message: HelloGoodbye
};

// message: hello
process(message); // HelloGood bye
// message: Hello
```

引数として渡された`message`は`process`関数の中で加工されて`'HelloGood bye'`となって返されます。しかし、関数の外の`message`は変わりません。これは値渡しが発生したためです。

##### 参照渡しの例:
```js
var list = [];
var process = function(list) {
  list[0] = 'Hello';
};

// list: []
process(list);
// list: ['Hello']
```

引数として渡された`list`は配列です(配列については次項で説明します。ここではこういうものだと眺めておいてください)。`process`が呼び出される前は`list`には要素が存在しませんが、呼び出し後には`list`の0番目の要素として`'Hello'`が追加されています。

