# ざっくりとしたオブジェクト指向の概要
## 解説の前に
近年流行している多くの言語が「オブジェクト指向プログラミング(Object-oriented programming, OOP)」というものをサポートしており、多くのソフトウェア開発でこの手法が採用されています。

しかし、オブジェクト指向というパラダイムは初学者にとってとっつきにくい概念です(パラダイムとは、プログラムを書く上でのお作法のようなものです)。

そのとっつきにくさは言葉の定義の多さや複雑さ、概念と実際のコードの関連が掴みづらいなどが挙げられます。このテキストはJavaScriptの初歩を学べる、ということを重視しているため説明を大幅に省きます。また、中には適切でない表現があるかもしれません。ある程度「こういう考え方なんだな」ということを掴んでみてください。

このテキストを1度読むだけでは完全に理解しきることはできないかもしれません。実際にJavaScriptのコードを書いてみてOOPを体感してみるというのも重要です。

## オブジェクト指向のポイント
以下にオブジェクト指向を理解する際に重要なキーワードを並べてみました。

* オブジェクト
* クラス
* インスタンス
* 状態と振る舞い
* カプセル化
* 密結合と疎結合

おおよそ上から重要度順に並べてあります。

なお、この章において「オブジェクト」と書いた場合JavaScriptにおけるオブジェクトのことを**指しません**。JavaScriptのオブジェクトを指す場合はそれがわかるように記述します。混同しやすいので注意してください。

## オブジェクト指向とはなにか / なぜオブジェクト指向で書くのか
オブジェクト指向は雑に言ってしまえば 「**同じようなデータと処理をまとめておくプログラムの書き方**」です。そして、OOPにおけるオブジェクトとはデータと処理の集合体です。「基本的なパーツ」の「オブジェクト」項で最後に例として上げたJavaScriptのオブジェクトを見てみましょう。

```js
var me = {
  name: 'masawada',
  age: 21,
  hasGirlFriend: false,
  like: ['寿司', '焼肉'],
  mostLike: function() {
    return me.like[0];
  }
};
```

これは`name`や`age`、`hasGirlFriend`などのデータと`mostLike`という一番好きな食べ物を返す処理を持ったオブジェクトです。実はこのコードを書いた時点でオブジェクト指向の入り口にすでに立っていたのです。

OOPで達成したいことは

* 似たような処理/データを整理して大規模なプログラムを書く際にコードを読みやすくする
* 整理をすることで同じコードを複数回書かない
* 一部の処理を変更した場合に全部を書き換えなくて済むようにする

といったようなことです。といっても、OOPの恩恵は実際にコードを書きつづけないとわかりません。本当はまだいろいろとメリットがあるのですが、ここでは省略します。

## オブジェクトの状態と振る舞い
普通、C言語などでは文字列の長さを調べるのに以下のようなコードを書きます。

```c
strlen("hello, world"); // => 12
```

これは文字列の長さ(文字の配列の要素数)を数える関数(処理)に文字列を引数として与える、ということを意味しています。

一方、JavaScriptでは以下のようなコードを書きます。

```js
"hello, world".length; // => 12
```

これは文字列そのものが文字数というデータ(状態)を持っていてそれを参照している、という意味です。

OOPをサポートする言語において、オブジェクトはこのように「状態」を保持します。状態のことをプロパティとも呼びます。

振る舞いも同様です。

```js
"hoge".replace('o', 'a'); // => "hage"
```

これは`"hoge"`という文字列のoをaに変えて`"hage"`にするコードです。C言語などではひたすら特定の処理を行う関数を書いてその関数に引数を与え返り値を得るという手法でプログラムを構造化していました。オブジェクト指向プログラミングではオブジェクトが処理(振る舞い)を持つようにプログラムを設計します。振る舞いのことをメソッドとも呼びます。

### 少し高度な解説
だいたいのOOPをサポートする言語においては文字列や数値のような値もオブジェクトです。しかしJavaScriptにおいてこれらはオブジェクトではありません。「基本的なパーツ」でも説明したとおりJavaScriptの値はあくまでプリミティブ値であり、メソッドやプロパティを持ちません。`"hello, world".length`のように記述するとその文字列を一度Stringオブジェクトに変換し、その`length`プロパティを参照する仕組みになっています。

## クラスとインスタンス
「クラスとインスタンス」と銘打ちましたが、JavaScriptにはクラスがありません。そのかわりにプロトタイプという似たような仕組みがあります。プロトタイプについては別に章をたてて詳しく解説します。

クラスとは、データや処理をまとめるための枠組みです。クラスにはプロパティ名やメソッドなどの定義を書きます。これにデータを流し込んだものがインスタンスです。インスタンスを作ることをインスタンス化と呼びます。

クラスやインスタンスはすべてオブジェクトであり、クラスオブジェクト、インスタンスオブジェクトとも呼びます。

おそらくこれだけでは何を言っているのか全くわからないと思います。先ほどのJavaScriptのオブジェクトを例にとって説明します(ただし、これは概念を説明するためのコードなので実際にはこのような書き方はしません)。

人間が一人だと寂しいので複数人の人間の情報を定義したいと思います。ここでは`me`と`you`を定義することにしましょう。それぞれ保持したい情報は前述の通り名前、歳、彼女の有無、好きな食べ物のリストです。また、一番好きな食べ物を教えてもらうためのメソッドも定義しましょう。

```js
var Person = {
  name: '',
  age: 0,
  hasGirlFriend: false,
  like: [],
  mostLike: function() {
    return this.like[0];
  }
};
```

これがクラス(のようなもの)です。これでデータの容れ物を定義することができました。それではこのPersonをインスタンス化してみましょう。まずは`me`というインスタンスを作成します。ここでは`Object.create`というものを使います。Object.createについては別の章でプロトタイプなどと一緒に解説します(`this`というキーワードが使われていますが、これについても別の章で説明します。)

```js
var me = Object.create(Person);
me.name = 'masawada';
me.age = 21;
me.hasGirlFriend = false;
me.like = ['寿司', '焼肉'];
me.mostLike(); // => '寿司'
```

つづいて`you`というインスタンスを作成します。

```js
var you = Object.create(Person);
you.name = 'benevolent0505';
you.age = 21;
you.hasGirlFriend = false;
you.like = ['ピザ', '蕎麦'];
you.mostLike(); // => 'ピザ'
```

このようにして`Person`クラスをもとに`me`インスタンス、`you`インスタンスを生成することができました。たとえば好きではあるけどそここまで好きではない食べ物を教えてほしいときはどうすれば良いでしょうか。答えは簡単です。`Person`クラスに`worstLike`メソッドを追加すれば良いだけです。

OOPの大きな特徴の一つがこのようにして「一つのクラスから類似するモノを生成して使う」、または「同じようなものをクラスを使ってまとめる」プログラミングの手法です。これにより類似するデータにそれぞれ振る舞いを与えずとも一箇所を書き換えることですべてのデータの振る舞いを定義できるのがOOPのメリットです。

以上がクラスの定義とインスタンス化の大まかな概念です。

### 少し高度な解説
上記の例ではインスタンス化してからメソッドを呼び出していましたが、たいていのOOPを採用する言語ではクラスで呼び出せるメソッドも定義することができます。前者をインスタンスメソッド、後者をクラスメソッドと呼びます。クラスメソッドのことを静的なメソッドと呼ぶこともあります。

### 少し高度な解説(その2)
JavaScriptではprivateやprotectedなメソッドやプロパティを作ることができません。メソッド/プロパティに`_`のような記号を前置することでプライベートであると宣言する運用などがよく用いられます。

## カプセル化
例えば、`Person`の中には男性だけでなく女性もいます。それぞれ`hasGirlFriend`と問うのが失礼な場合もあります。そこで、`hasBoyFriend`も定義することにします。しかし、通常恋人は1人とかんがえられるので、わざわざ`hasGirlFriend`と`hasBoyFriend`を表に出す必要はありません。そこで、`hasLover`も定義しましょう。`hasLover`は`hasGirlFriend`または`hasBoyFriend`が`true`のときに`true`を返すメソッドとします。

さらに、`hasGirlFriend`が`true`のときは`hasBoyFriend`が`false`に、`hasGirlFriend`が`false`のときは`hasBoyFriend`が`true`になってほしいため、彼女または彼氏を設定するための`setGirlFriend`メソッド、`setBoyFriend`メソッドも定義します。

```js
var Person = {
  name: '',
  age: 0,
  hasGirlFriend: false,
  hasBoyFriend: false,
  hasLover: function() {
    return this.hasGirlFriend || this.hasBoyFriend;
  },
  setGirlFriend: function() {
    this.hasGirlFriend = true;
    this.hasBoyFriend = false;
  },
  setBoyFriend: function() {
    this.hasGirlFriend = false;
    this.hasBoyFriend: true;
  },
  like: [],
  mostLike: function() {
    return this.like[0];
  }
};
```

これらの機能を実現する上で`hasGirlFriend`や`hasBoyFriend`を直接操作されるとこれら療法のプロパティが`true`になる可能性があり、これは製作者の意図しない不具合(=バグ)が発生する原因となります。そのため、多くの場合オブジェクトの内部状態を確認するためのメソッド(getter)やオブジェクトの内部状態を変更するためのメソッド(setter)を定義します。

このように、外側から内部を操作されると不具合が発生するため内部状態を外に明かさないことをカプセル化(隠蔽)と呼びます。

(試しに`Person`クラスに失恋した時に呼び出す`brokenHeart`メソッドを作ってみましょう)

## 密結合と疎結合
これまで見てきたとおり、OOPではオブジェクトをひたすら生成してそのメソッドやデータを駆使して処理を行うという手法をとります。この際、あるオブジェクトが別のオブジェクトの内部を直接操作するような記述をするとどうなるでしょうか？もしその別のオブジェクトの操作先に変更があった場合、操作元のオブジェクトにも変更を加える必要がでてきます。場合によってはそれが連鎖する可能性があります。このようにオブジェクトが別のオブジェクトに依存している(べったりくっついている)状態を密結合と呼びます。

逆に、オブジェクト同士の依存度が低い状態を疎結合と呼びます。疎結合の場合、一つのオブジェクトに変更を加えたとしても別のオブジェクトの変更が少なくて済みます。このように疎結合の場合はプログラムの変更が簡便になるため、OOPではオブジェクト同士がなるべく疎結合になることが求められています。

## オブジェクト指向のまとめ
以上がオブジェクト指向における基本的な事項の一部になります。本当は他にも重要な事項が存在しますが、大雑把に理解すべき部分はこの程度ということでこの節を一旦締めます。

